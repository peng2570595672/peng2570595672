const dataHandler = require('./DataHandler.js'); const dataUtil = require('./DataUtil.js'); module['exports'] = { 'connectAndInit': connectDevice, 'disConnect': disconnectDevice, 'sendAndReceive': transCmd, 'getPhyCardNum': getPhyCardNum }; const codeEnum = { 'successCode': 0x3e8, 'failureCode': 0x1, 'stopScanFailure': 0x2, 'creatConnectionFailure': 0x3, 'getServiceFailure': 0x4, 'noTargetServiceId': 0x5, 'getCharacteristicsFailure': 0x6, 'noTargetCharacteristic': 0x7, 'monitorNotificationFailure': 0x8, 'authResponseFailure': 0x9, 'initResponseFailure': 0xa, 'initDeviceFailure': 0xb, 'dataFrameTransboundary': 0xc, 'notPassBccCheck': 0xd, 'sendDataFailure': 0xe, 'paraError': 0xf, 'timeout': 0x64 }; const FUNCTION = 'function'; const serviceUUID = '0000FEE7-0000-1000-8000-00805F9B34FB'; const writeUUID = '0000FEC7-0000-1000-8000-00805F9B34FB'; const readUUID = '0000FEC8-0000-1000-8000-00805F9B34FB'; const connectTime = 0x14 * 0x3e8; const startA2Time = 0xf0; const waitA2ResponseTime = 0x3e8; var haveFoundDevice = new Array(); var connectDeviceId; var connectCallback; var connectTimer; var frame = ''; var frameLen = 0x0; var frames = new Array(); var framesLen = 0x0; var dataHandlerCallback; var sendBufferArray = new Array(); var cmds = new Array(); var sendIndex; var resendCount = 0x3; function toObject(_0x580f0a, _0xec3851, _0x24a8c5) { return { 'code': _0x580f0a, 'data': _0xec3851, 'msg': _0x24a8c5 }; } function startConnectBle() { var _0x27f6a3 = { 'WRdjq': function (_0x8bfce3) { return _0x8bfce3(); }, 'deqFf': function (_0x31f188, _0x260119) { return _0x31f188 != _0x260119; }, 'wESPB': function (_0x2a9003, _0x1a0348) { return _0x2a9003(_0x1a0348); }, 'oZVGj': function (_0x4fdb71, _0x434cda) { return _0x4fdb71 == _0x434cda; }, 'NNEbM': function (_0x57ad0c, _0x4a8329, _0x3cd570, _0x33861d) { return _0x57ad0c(_0x4a8329, _0x3cd570, _0x33861d); }, 'DuCEn': 'creatConnectionFailure', 'LIBPN': function (_0x441bc7, _0x1ce0d9) { return _0x441bc7 == _0x1ce0d9; }, 'LwLHs': 'createBLEConnection' }; if (_0x27f6a3['LIBPN'](connectTimer, undefined)) { return; } wx[_0x27f6a3['LwLHs']]({ 'deviceId': connectDeviceId, 'success': function (_0x25a9c1) { _0x27f6a3['WRdjq'](startGetAndCheckService); }, 'fail': function () { if (_0x27f6a3['deqFf'](connectTimer, undefined)) { _0x27f6a3['wESPB'](clearTimeout, connectTimer); _0x27f6a3['oZVGj'](typeof connectCallback['fail'], FUNCTION) && connectCallback['fail'](_0x27f6a3['NNEbM'](toObject, 0xfa0, undefined, _0x27f6a3['DuCEn'])); } } }); } function startGetAndCheckService() { var _0x599db8 = { 'sdSVW': function (_0x5895f8, _0x17b490) { return _0x5895f8 < _0x17b490; }, 'CIiHN': 'services', 'ANjAZ': 'length', 'QBMMO': 'uuid', 'NTDNF': function (_0x5d129e, _0x3af2dc) { return _0x5d129e == _0x3af2dc; }, 'lIORB': function (_0x94a5da, _0x430097) { return _0x94a5da == _0x430097; }, 'QQEUc': function (_0x5b38a7) { return _0x5b38a7(); }, 'KpWNN': function (_0x4a5fe7, _0xaf6efb) { return _0x4a5fe7 != _0xaf6efb; }, 'mWtmy': function (_0x3c6715, _0x1148a9) { return _0x3c6715(_0x1148a9); }, 'WJzUh': function (_0x567743, _0x2781d8, _0x1ba587, _0x4dbccb) { return _0x567743(_0x2781d8, _0x1ba587, _0x4dbccb); }, 'aroFW': 'noTargetServiceId', 'zoexw': function (_0xad9fa8, _0x5607a4) { return _0xad9fa8 == _0x5607a4; }, 'tXLKG': function (_0xb956b2, _0x9f4ce0) { return _0xb956b2(_0x9f4ce0); }, 'tccLU': 'getServiceFailure', 'SbvpW': function (_0xb3c6e2, _0x3ca4d1) { return _0xb3c6e2 == _0x3ca4d1; }, 'ZnhrD': 'getBLEDeviceServices' }; if (_0x599db8['SbvpW'](connectTimer, undefined)) { return; } wx[_0x599db8['ZnhrD']]({ 'deviceId': connectDeviceId, 'success': function (_0x5477a8) { let _0x40911f = ![]; for (let _0x13719a = 0x0; _0x599db8['sdSVW'](_0x13719a, _0x5477a8[_0x599db8['CIiHN']][_0x599db8['ANjAZ']]); _0x13719a++) { let _0x4f8d8a = _0x5477a8[_0x599db8['CIiHN']][_0x13719a][_0x599db8['QBMMO']]; if (_0x599db8['NTDNF'](_0x4f8d8a, serviceUUID)) { _0x40911f = !![]; break; } } if (_0x599db8['lIORB'](_0x40911f, !![])) { _0x599db8['QQEUc'](startGetAndCheckCharacterisitc); } else { if (_0x599db8['KpWNN'](connectTimer, undefined)) { _0x599db8['mWtmy'](clearTimeout, connectTimer); _0x599db8['lIORB'](typeof connectCallback, FUNCTION) && _0x599db8['mWtmy'](connectCallback, _0x599db8['WJzUh'](toObject, codeEnum[_0x599db8['aroFW']], undefined, _0x599db8['aroFW'])); } } }, 'fail': function () { if (_0x599db8['KpWNN'](connectTimer, undefined)) { _0x599db8['mWtmy'](clearTimeout, connectTimer); _0x599db8['zoexw'](typeof connectCallback, FUNCTION) && _0x599db8['tXLKG'](connectCallback, _0x599db8['WJzUh'](toObject, codeEnum[_0x599db8['tccLU']], undefined, _0x599db8['tccLU'])); } } }); } function startGetAndCheckCharacterisitc() { var _0x765c3b = { 'cHaUf': function (_0x179921, _0x151fa5) { return _0x179921 < _0x151fa5; }, 'mqDRV': 'characteristics', 'RAzjE': 'length', 'AnwCw': 'uuid', 'wpack': function (_0x8e14a9, _0x2b1d3e) { return _0x8e14a9 == _0x2b1d3e; }, 'DNQtW': function (_0x1d47a6, _0x163ffa) { return _0x1d47a6 == _0x163ffa; }, 'PHTps': function (_0x4b6554, _0x593373) { return _0x4b6554 == _0x593373; }, 'SrhST': function (_0x208d8e, _0x1e88c6) { return _0x208d8e == _0x1e88c6; }, 'cTttD': function (_0x270a82, _0xa4d5e7) { return _0x270a82 == _0xa4d5e7; }, 'KJcgL': function (_0x19e546, _0x43b9a0) { return _0x19e546 == _0x43b9a0; }, 'pKGJz': function (_0x1974fa) { return _0x1974fa(); }, 'QdsDg': function (_0x5ae949, _0x4a5340) { return _0x5ae949 != _0x4a5340; }, 'DwsPs': function (_0x3674ab, _0xf0fb48) { return _0x3674ab(_0xf0fb48); }, 'QNGtz': function (_0x181147, _0x3560d4) { return _0x181147 == _0x3560d4; }, 'jHSyO': function (_0x338cd5, _0x29d037, _0x397c6e, _0x58f7b4) { return _0x338cd5(_0x29d037, _0x397c6e, _0x58f7b4); }, 'tXcan': 'noTargetCharacteristic', 'oTTif': function (_0x327612, _0x8aed8f) { return _0x327612 == _0x8aed8f; }, 'mFAtn': function (_0x1e9608, _0x3dce0d) { return _0x1e9608(_0x3dce0d); }, 'gNLto': 'getCharacteristicsFailure', 'BNFkX': 'getBLEDeviceCharacteristics' }; if (_0x765c3b['oTTif'](connectTimer, undefined)) { return; } wx[_0x765c3b['BNFkX']]({ 'deviceId': connectDeviceId, 'serviceId': serviceUUID, 'success': function (_0x13a08b) { let _0x431763 = ![]; let _0x34dc74 = ![]; for (let _0x14dc8d = 0x0; _0x765c3b['cHaUf'](_0x14dc8d, _0x13a08b[_0x765c3b['mqDRV']][_0x765c3b['RAzjE']]); _0x14dc8d++) { let _0x1aff5e = _0x13a08b[_0x765c3b['mqDRV']][_0x14dc8d][_0x765c3b['AnwCw']]; if (_0x765c3b['wpack'](_0x1aff5e, readUUID)) { _0x431763 = !![]; } else if (_0x765c3b['DNQtW'](_0x1aff5e, writeUUID)) { _0x34dc74 = !![]; } if (_0x765c3b['PHTps'](_0x431763, !![]) && _0x765c3b['SrhST'](_0x34dc74, !![])) { break; } } if (_0x765c3b['cTttD'](_0x431763, !![]) && _0x765c3b['KJcgL'](_0x34dc74, !![])) { _0x765c3b['pKGJz'](monitorNotification); } else { if (_0x765c3b['QdsDg'](connectTimer, undefined)) { _0x765c3b['DwsPs'](clearTimeout, connectTimer); _0x765c3b['QNGtz'](typeof connectCallback, FUNCTION) && _0x765c3b['DwsPs'](connectCallback, _0x765c3b['jHSyO'](toObject, 0xfa0, undefined, _0x765c3b['tXcan'])); } } }, 'fail': function () { if (_0x765c3b['QdsDg'](connectTimer, undefined)) { _0x765c3b['DwsPs'](clearTimeout, connectTimer); _0x765c3b['oTTif'](typeof connectCallback, FUNCTION) && _0x765c3b['mFAtn'](connectCallback, _0x765c3b['jHSyO'](toObject, 0xfa0, undefined, _0x765c3b['gNLto'])); } } }); } function monitorNotification() { var _0x309ff2 = { 'tvuhH': function (_0x1b398a, _0x3ce807) { return _0x1b398a != _0x3ce807; }, 'MrZxU': function (_0x22a507, _0xe2aca4) { return _0x22a507(_0xe2aca4); }, 'FDpmf': function (_0x19922d, _0x43a915) { return _0x19922d == _0x43a915; }, 'kEUsy': function (_0x434745, _0x21bdb0, _0x3b46d0, _0x48a1a5) { return _0x434745(_0x21bdb0, _0x3b46d0, _0x48a1a5); }, 'caOtC': 'successCode', 'lqCYT': '连接成功,握手成功', 'sdVjd': function (_0x4340ac, _0x1247a7) { return _0x4340ac != _0x1247a7; }, 'GwkEn': function (_0xa50b4, _0x22b222) { return _0xa50b4(_0x22b222); }, 'KFkCN': 'monitorNotificationFailure', 'ZsZkn': 'deviceId', 'JbptS': function (_0x516c4a, _0x2bd827) { return _0x516c4a == _0x2bd827; }, 'wVMTu': 'serviceId', 'nBiHh': 'characteristicId', 'vqlRf': function (_0x3091d8, _0x4d793e) { return _0x3091d8(_0x4d793e); }, 'UBMRL': 'value', 'naQLI': function (_0xdc97e3, _0x35beb9) { return _0xdc97e3 == _0x35beb9; }, 'TMdMg': 'notifyBLECharacteristicValueChange', 'TwtfU': 'onBLECharacteristicValueChange' }; if (_0x309ff2['naQLI'](connectTimer, undefined)) { return; } wx[_0x309ff2['TMdMg']]({ 'deviceId': connectDeviceId, 'serviceId': serviceUUID, 'characteristicId': readUUID, 'state': !![], 'success': function (_0x1b37a4) { if (_0x309ff2['tvuhH'](connectTimer, undefined)) { _0x309ff2['MrZxU'](clearTimeout, connectTimer); _0x309ff2['FDpmf'](typeof connectCallback['success'], FUNCTION) && connectCallback['success'](_0x309ff2['kEUsy'](toObject, codeEnum[_0x309ff2['caOtC']], undefined, _0x309ff2['lqCYT'])); } }, 'fail': function () { if (_0x309ff2['sdVjd'](connectTimer, undefined)) { _0x309ff2['GwkEn'](clearTimeout, connectTimer); _0x309ff2['FDpmf'](typeof connectCallback['fail'], FUNCTION) && connectCallback['fail'](_0x309ff2['kEUsy'](toObject, 0xfa0, undefined, _0x309ff2['KFkCN'])); } } }); wx[_0x309ff2['TwtfU']](function (_0x36ea86) { if (_0x36ea86[_0x309ff2['ZsZkn']] = connectDeviceId && _0x309ff2['JbptS'](_0x36ea86[_0x309ff2['wVMTu']], serviceUUID) && _0x309ff2['JbptS'](_0x36ea86[_0x309ff2['nBiHh']], readUUID)) { _0x309ff2['vqlRf'](analyticData, _0x36ea86[_0x309ff2['UBMRL']]); } }); } function analyticData(_0x3fcc98) { var _0x30ad6a = { 'iDJRN': 'bufferArrayToHexString', 'iTbSt': 'log', 'jkZrT': function (_0x4c18dc, _0x2ff477) { return _0x4c18dc + _0x2ff477; }, 'YDAhT': '接收：', 'qmoxn': function (_0x2dadb6, _0x13b9e8) { return _0x2dadb6 == _0x13b9e8; }, 'soBnV': 'length', 'IPhIN': function (_0x5e7270, _0x5f3b25) { return _0x5e7270 * _0x5f3b25; }, 'ViDNR': function (_0x552407, _0xcb7d22, _0x14c4ba) { return _0x552407(_0xcb7d22, _0x14c4ba); }, 'hCUBi': 'slice', 'gLYVw': function (_0x52dbac, _0x54b517) { return _0x52dbac != _0x54b517; }, 'ZfImt': 'fe01', 'vPJNO': function (_0x49438b, _0x6d0182) { return _0x49438b > _0x6d0182; }, 'zCbjK': function (_0x473bea, _0x267ac0) { return _0x473bea == _0x267ac0; }, 'TlInJ': function (_0xcbb56d, _0xd81c9b) { return _0xcbb56d(_0xd81c9b); }, 'NGMev': function (_0x42710e, _0x4caa7e, _0x299af4, _0x464442) { return _0x42710e(_0x4caa7e, _0x299af4, _0x464442); }, 'ZrStL': 'dataFrameTransboundary', 'nfZsy': '数据长度越界', 'yCupi': function (_0x2ba640, _0x294558) { return _0x2ba640 == _0x294558; }, 'MCFzK': function (_0x528bcd, _0x1ff4e5) { return _0x528bcd === _0x1ff4e5; }, 'KgBmh': '2712', 'udRzX': function (_0xb500d2, _0x4730bd) { return _0xb500d2 + _0x4730bd; }, 'OmtoZ': function (_0x2cb87c, _0x3e0851) { return _0x2cb87c - _0x3e0851; }, 'mAGFT': 'push', 'GFhiv': function (_0xfb996f, _0x64dfa) { return _0xfb996f == _0x64dfa; }, 'UAllo': function (_0x5337b2, _0x48e2d1) { return _0x5337b2 < _0x48e2d1; }, 'sGHJu': function (_0x510180, _0x554e44) { return _0x510180 / _0x554e44; }, 'pGszn': function (_0x113740, _0x3fb5fb) { return _0x113740 * _0x3fb5fb; }, 'gdURb': function (_0x72c249, _0x5a5526) { return _0x72c249 + _0x5a5526; }, 'YJGbq': function (_0x51844a, _0x2a4ea3, _0x29cb22) { return _0x51844a(_0x2a4ea3, _0x29cb22); }, 'WsESb': function (_0x3a502d, _0x190889) { return _0x3a502d == _0x190889; }, 'tgawG': function (_0x3e816f, _0x19a2ea, _0x253c5c, _0x37cafe) { return _0x3e816f(_0x19a2ea, _0x253c5c, _0x37cafe); }, 'Qvfty': 'notPassBccCheck', 'CIRkB': 'bcc校验不通过', 'OGRQp': function (_0x1070c2, _0x2c2278) { return _0x1070c2 < _0x2c2278; }, 'vyJNu': function (_0x5d0f52, _0x5cb7dc, _0x4e868c, _0x1a56d2) { return _0x5d0f52(_0x5cb7dc, _0x4e868c, _0x1a56d2); }, 'RMgJS': 'successCode', 'AgKhr': '无效数据' }; let _0x3e2cda = dataHandler[_0x30ad6a['iDJRN']](_0x3fcc98); console[_0x30ad6a['iTbSt']](_0x30ad6a['jkZrT'](_0x30ad6a['YDAhT'], _0x3e2cda)); if (_0x30ad6a['qmoxn'](frame[_0x30ad6a['soBnV']], 0x0)) { frameLen = _0x30ad6a['IPhIN'](_0x30ad6a['ViDNR'](parseInt, _0x3e2cda[_0x30ad6a['hCUBi']](0x4, 0x8), 0x10), 0x2); } frame += _0x3e2cda; if (_0x30ad6a['gLYVw'](frame[_0x30ad6a['hCUBi']](0x0, 0x4), _0x30ad6a['ZfImt'])) { frame = ''; frameLen = 0x0; } else if (_0x30ad6a['vPJNO'](frame[_0x30ad6a['soBnV']], frameLen)) { frame = ''; frameLen = 0x0; _0x30ad6a['zCbjK'](typeof dataHandlerCallback, FUNCTION) && _0x30ad6a['TlInJ'](dataHandlerCallback, _0x30ad6a['NGMev'](toObject, codeEnum[_0x30ad6a['ZrStL']], '', _0x30ad6a['nfZsy'])); } else if (_0x30ad6a['yCupi'](frame[_0x30ad6a['soBnV']], frameLen)) { let _0x3e2764 = frame[_0x30ad6a['hCUBi']](0x8, 0xc); if (_0x30ad6a['MCFzK'](_0x3e2764, _0x30ad6a['KgBmh'])) { let _0x57abc2 = frame[_0x30ad6a['hCUBi']](0x10); let _0x4e5c73 = _0x57abc2[_0x30ad6a['hCUBi']](0x8, -0x6); frame = ''; frameLen = 0x0; if (_0x30ad6a['yCupi'](frames[_0x30ad6a['soBnV']], 0x0)) { let _0x48c5d9 = _0x30ad6a['ViDNR'](parseInt, _0x4e5c73[_0x30ad6a['hCUBi']](0x4, 0x6), 0x10); framesLen = _0x30ad6a['udRzX'](_0x30ad6a['OmtoZ'](_0x48c5d9, 0x80), 0x1); } frames[_0x30ad6a['mAGFT']](_0x4e5c73); if (_0x30ad6a['GFhiv'](frames[_0x30ad6a['soBnV']], framesLen)) { let _0x57f2de = !![]; for (let _0x12ff7e = 0x0; _0x30ad6a['UAllo'](_0x12ff7e, frames[_0x30ad6a['soBnV']]); _0x12ff7e++) { let _0x5b70aa = frames[_0x12ff7e]; let _0x21cdac = 0x0; for (let _0x1ea1d4 = 0x1; _0x30ad6a['UAllo'](_0x1ea1d4, _0x30ad6a['OmtoZ'](_0x30ad6a['TlInJ'](parseInt, _0x30ad6a['sGHJu'](_0x5b70aa[_0x30ad6a['soBnV']], 0x2)), 0x1)); _0x1ea1d4++) { let _0x323879 = _0x30ad6a['ViDNR'](parseInt, _0x5b70aa[_0x30ad6a['hCUBi']](_0x30ad6a['IPhIN'](_0x1ea1d4, 0x2), _0x30ad6a['pGszn'](_0x30ad6a['gdURb'](_0x1ea1d4, 0x1), 0x2)), 0x10); _0x21cdac ^= _0x323879; } if (_0x30ad6a['gLYVw'](_0x21cdac, _0x30ad6a['YJGbq'](parseInt, _0x5b70aa[_0x30ad6a['hCUBi']](-0x2), 0x10))) { _0x57f2de = ![]; break; } } if (_0x30ad6a['GFhiv'](_0x57f2de, ![])) { frames = new Array(); framesLen = 0x0; _0x30ad6a['WsESb'](typeof dataHandlerCallback, FUNCTION) && _0x30ad6a['TlInJ'](dataHandlerCallback, _0x30ad6a['tgawG'](toObject, codeEnum[_0x30ad6a['Qvfty']], '', _0x30ad6a['CIRkB'])); } else { let _0x313ad6 = ''; for (let _0x12ff7e = 0x0; _0x30ad6a['OGRQp'](_0x12ff7e, frames[_0x30ad6a['soBnV']]); _0x12ff7e++) { let _0x5b70aa = frames[_0x12ff7e]; _0x313ad6 += _0x5b70aa[_0x30ad6a['hCUBi']](0x8, -0x2); } frames = new Array(); framesLen = 0x0; _0x30ad6a['WsESb'](typeof dataHandlerCallback, FUNCTION) && _0x30ad6a['TlInJ'](dataHandlerCallback, _0x30ad6a['vyJNu'](toObject, codeEnum[_0x30ad6a['RMgJS']], _0x313ad6, '成功')); } } } else { console[_0x30ad6a['iTbSt']](_0x30ad6a['AgKhr']); frame = ''; frameLen = 0x0; } } } function sendDataToDevice(_0x191d5d, _0x56dd4a) { var _0x4af4b9 = { 'qpCiz': '4|1|6|7|8|0|2|5|3', 'YMYZV': 'concat', 'VCayU': function (_0x2f2570) { return _0x2f2570(); } }; var _0x5a2b83 = _0x4af4b9['qpCiz']['split']('|'), _0x4aae48 = 0x0; while (!![]) { switch (_0x5a2b83[_0x4aae48++]) { case '0': frames = new Array(); continue; case '1': sendBufferArray = new Array()[_0x4af4b9['YMYZV']](_0x191d5d); continue; case '2': framesLen = 0x0; continue; case '3': _0x4af4b9['VCayU'](runningSendData); continue; case '4': dataHandlerCallback = _0x56dd4a; continue; case '5': resendCount = 0x3; continue; case '6': sendIndex = 0x0; continue; case '7': frame = ''; continue; case '8': frameLen = 0x0; continue; }break; } } function connectDevice(_0x4245b7, _0x1d975b, _0x141c1e) { var _0x5d4f8d = { 'FFRPD': '1|0|2|3|5|4', 'ZehbJ': 'deviceId', 'oiRsh': function (_0x2c1860, _0x8af71e) { return _0x2c1860 == _0x8af71e; }, 'KfWKg': function (_0x554420, _0x3a89cd, _0x26bbc9, _0x3bb78c) { return _0x554420(_0x3a89cd, _0x26bbc9, _0x3bb78c); }, 'YOKfR': '连接超时', 'oBati': function (_0x5f440e, _0x46d1e3) { return _0x5f440e != _0x46d1e3; }, 'ILPcV': function (_0x2fa905, _0x140444) { return _0x2fa905(_0x140444); }, 'UZiIm': function (_0x50dafd) { return _0x50dafd(); }, 'HPJBi': function (_0x263ef1, _0x42b99d, _0x520564) { return _0x263ef1(_0x42b99d, _0x520564); } }; var _0x4e9b05 = _0x5d4f8d['FFRPD']['split']('|'), _0x2c2183 = 0x0; while (!![]) { switch (_0x4e9b05[_0x2c2183++]) { case '0': connectDeviceId = _0x4245b7[_0x5d4f8d['ZehbJ']]; continue; case '1': var _0x221caf = { 'CAQLw': function (_0x2192a0, _0x3b5e07) { return _0x5d4f8d['oiRsh'](_0x2192a0, _0x3b5e07); }, 'NftOM': function (_0x411745, _0x2e10bf, _0x5aa4a5, _0xd13c6c) { return _0x5d4f8d['KfWKg'](_0x411745, _0x2e10bf, _0x5aa4a5, _0xd13c6c); }, 'MqfEZ': _0x5d4f8d['YOKfR'] }; continue; case '2': connectCallback = _0x1d975b; continue; case '3': if (_0x5d4f8d['oBati'](connectTimer, undefined)) { _0x5d4f8d['ILPcV'](clearTimeout, connectTimer); } continue; case '4': _0x5d4f8d['UZiIm'](startConnectBle); continue; case '5': connectTimer = _0x5d4f8d['HPJBi'](setTimeout, () => { connectTimer = undefined; _0x221caf['CAQLw'](typeof connectCallback['fail'], FUNCTION) && connectCallback['fail'](_0x221caf['NftOM'](toObject, 0x7d2, undefined, _0x221caf['MqfEZ'])); }, _0x141c1e); continue; }break; } } function disconnectDevice(_0x14b138) { var _0x172cab = { 'HCfMT': function (_0x2957cb, _0x16325a) { return _0x2957cb == _0x16325a; }, 'irGyL': function (_0x510a66, _0x4594f0, _0x111940, _0x464c87) { return _0x510a66(_0x4594f0, _0x111940, _0x464c87); }, 'GemXz': 'successCode', 'IfMeB': '断开连接成功', 'TEKhy': function (_0x5b071d, _0x3768d6) { return _0x5b071d == _0x3768d6; }, 'vyNFW': '断开连接失败', 'klwjZ': function (_0x47b273, _0x1d23dc) { return _0x47b273(_0x1d23dc); } }; const _0x2e1705 = _0x172cab['klwjZ'](String, connectDeviceId); wx['closeBLEConnection']({ 'deviceId': _0x2e1705, 'success'(_0x271717) { console['log'](_0x271717); _0x172cab['HCfMT'](typeof _0x14b138['success'], FUNCTION) && _0x14b138['success'](_0x172cab['irGyL'](toObject, codeEnum[_0x172cab['GemXz']], _0x271717, _0x172cab['IfMeB'])); }, 'fail'(_0x450b84) { console['log'](_0x450b84); _0x172cab['TEKhy'](typeof _0x14b138['fail'], FUNCTION) && _0x14b138['fail'](_0x172cab['irGyL'](toObject, 0xfa0, _0x450b84, _0x172cab['vyNFW'])); } }); } function promise(_0xf184d9, _0x22d233) { var _0x408546 = { 'JFOnm': function (_0x126fe4, _0x430d87) { return _0x126fe4 === _0x430d87; }, 'VxqFf': function (_0x10135a, _0x9127a6) { return _0x10135a === _0x9127a6; }, 'DJUBJ': 'successCode', 'YzDaI': '发送数据成功', 'BjgUm': function (_0x20ef08, _0x1acd79) { return _0x20ef08 == _0x1acd79; }, 'AZVto': function (_0x1301a0, _0x4dfd7a) { return _0x1301a0(_0x4dfd7a); }, 'WJJRN': function (_0x4c48ea, _0x35a030) { return _0x4c48ea(_0x35a030); }, 'XbRyo': '数据返回错误', 'NXlgv': 'TLV指令集有指令执行失败', 'BOlQZ': function (_0x138b3f, _0x3c2e7d) { return _0x138b3f + _0x3c2e7d; }, 'gRJRJ': '条指令执行失败', 'nPctd': function (_0x5213ad, _0x4c8de0) { return _0x5213ad + _0x4c8de0; }, 'rGEuL': '错误码:', 'LPrXu': function (_0x2581ea, _0x2bbaec) { return _0x2581ea - _0x2bbaec; }, 'PVuWb': function (_0x162a2b, _0xe4bf05) { return _0x162a2b - _0xe4bf05; }, 'ixLUB': '发送数据失败', 'QEotf': function (_0x1b1f18, _0x3c7fb5, _0x3c4256) { return _0x1b1f18(_0x3c7fb5, _0x3c4256); } }; return new Promise((_0x47f1a0, _0x7ea248) => { if (_0x408546['VxqFf'](_0x22d233, 0x0)) { var _0x18115b = dataUtil['makeA3SendData']('00', dataHandler['makeTLV']([_0xf184d9])); } else { var _0x18115b = dataUtil['makeA8SendData']('00', dataHandler['makeTLV']([_0xf184d9])); } _0x408546['QEotf'](sendDataToDevice, _0x18115b, _0x241d5d => { if (_0x408546['JFOnm'](dataHandler, undefined)) { return; } if (_0x408546['VxqFf'](_0x241d5d['code'], codeEnum[_0x408546['DJUBJ']])) { console['log'](_0x408546['YzDaI']); if (_0x408546['VxqFf'](_0x241d5d['data']['slice'](0x2, 0x4), '00') || _0x408546['VxqFf'](_0x241d5d['data']['slice'](0x2, 0x4), 'cf')) { let _0x33d5e1 = _0x241d5d['data']['slice'](0xa); let _0x4b34f8 = dataHandler['resolveTLV'](_0x241d5d['data']['slice'](0xa)); console['log'](_0x4b34f8); if (_0x408546['BjgUm'](_0x4b34f8['length'], 0x1)) { _0x408546['AZVto'](_0x47f1a0, _0x4b34f8[0x0]); } else { _0x408546['WJJRN'](_0x7ea248, _0x408546['XbRyo']); } } else { console['log'](_0x408546['NXlgv']); let _0x55ce3b = _0x241d5d['data']['slice'](0xa); let _0x4b34f8 = dataHandler['resolveTLV'](_0x241d5d['data']['slice'](0xa)); console['log'](_0x408546['BOlQZ'](_0x408546['BOlQZ']('第', _0x4b34f8['length']), _0x408546['gRJRJ'])); console['log'](_0x408546['nPctd'](_0x408546['rGEuL'], _0x4b34f8[_0x408546['LPrXu'](_0x4b34f8['length'], 0x1)]['slice'](-0x4))); _0x408546['WJJRN'](_0x7ea248, _0x408546['nPctd'](_0x408546['rGEuL'], _0x4b34f8[_0x408546['PVuWb'](_0x4b34f8['length'], 0x1)]['slice'](-0x4))); } } else { console['log'](_0x408546['ixLUB']); _0x408546['WJJRN'](_0x7ea248, _0x241d5d['msg']); } }); }); } function getPhyCardNum(_0x359762, _0x47c1f2) { var _0x215739 = { 'vBAoq': function (_0x2b12fc, _0x37790a) { return _0x2b12fc == _0x37790a; }, 'yUxlP': function (_0x47e60e, _0x1c2461, _0x312c69, _0x310b7c) { return _0x47e60e(_0x1c2461, _0x312c69, _0x310b7c); }, 'tRrxs': '获取卡片物理卡号超时', 'ZGbiq': function (_0x192faa, _0x1ba1c2) { return _0x192faa != _0x1ba1c2; }, 'dxLZN': function (_0x45d01c, _0x242d1d) { return _0x45d01c(_0x242d1d); }, 'uiKuE': function (_0xc2a6f6, _0x31dc4d) { return _0xc2a6f6 === _0x31dc4d; }, 'YtjTt': function (_0x5353c2, _0x5c8828) { return _0x5353c2 === _0x5c8828; }, 'sVYnz': 'successCode', 'XVNWT': '发送数据成功', 'GfHNv': function (_0x1c2d7c, _0x2f0524) { return _0x1c2d7c === _0x2f0524; }, 'OEuVT': function (_0x29bbac, _0x1ffd1d) { return _0x29bbac === _0x1ffd1d; }, 'WPqlM': '返回数据异常', 'rUmjU': function (_0x39f818, _0x4acb1b) { return _0x39f818 == _0x4acb1b; }, 'UQzjR': function (_0x80d099, _0x2ca9fa, _0x4179be, _0x382473) { return _0x80d099(_0x2ca9fa, _0x4179be, _0x382473); }, 'Jhkxu': '获取SN返回数据异常', 'gsqSW': '发送数据失败', 'gSsnG': function (_0x5614f9, _0x207891) { return _0x5614f9 == _0x207891; }, 'kOPfs': function (_0x3c3333, _0xc773b4, _0x52c7c0) { return _0x3c3333(_0xc773b4, _0x52c7c0); }, 'BnrNq': function (_0x147ed8, _0x53c4c8, _0x13e507) { return _0x147ed8(_0x53c4c8, _0x13e507); } }; var _0x574821 = _0x215739['kOPfs'](setTimeout, () => { dataHandlerCallback = undefined; _0x215739['vBAoq'](typeof _0x359762['fail'], FUNCTION) && _0x359762['fail'](_0x215739['yUxlP'](toObject, 0x7d0, undefined, _0x215739['tRrxs'])); }, _0x47c1f2); var _0x34a746 = dataUtil['makeA5SendData']('C7'); _0x215739['BnrNq'](sendDataToDevice, _0x34a746, _0x1f457c => { if (_0x215739['ZGbiq'](_0x574821, undefined)) { _0x215739['dxLZN'](clearTimeout, _0x574821); } if (_0x215739['uiKuE'](dataHandler, undefined)) { return; } if (_0x215739['YtjTt'](_0x1f457c['code'], codeEnum[_0x215739['sVYnz']])) { console['log'](_0x215739['XVNWT']); console['log'](_0x1f457c['data']); if (_0x215739['YtjTt'](_0x1f457c['data']['slice'](0x2, 0x4), '00') && _0x215739['GfHNv'](_0x1f457c['data']['slice'](0x0, 0x2), 'b5') && _0x215739['OEuVT'](_0x1f457c['data']['slice'](0x6, 0x8), 'c7')) { let _0x1e6d7d = _0x1f457c['data']['slice'](0x8); console['log'](_0x1e6d7d); _0x215739['vBAoq'](typeof _0x359762['success'], FUNCTION) && _0x359762['success'](_0x215739['yUxlP'](toObject, codeEnum[_0x215739['sVYnz']], String['fromCharCode']['apply'](null, new Int8Array(dataHandler['hexStringToBufferArray'](_0x1e6d7d))), '成功')); } else { console['log'](_0x215739['WPqlM']); _0x215739['rUmjU'](typeof _0x359762['fail'], FUNCTION) && _0x359762['fail'](_0x215739['UQzjR'](toObject, 0x7d0, _0x1f457c['data'], _0x215739['Jhkxu'])); } } else { console['log'](_0x215739['gsqSW']); _0x215739['gSsnG'](typeof _0x359762['fail'], FUNCTION) && _0x359762['fail'](_0x215739['UQzjR'](toObject, 0x7d0, undefined, _0x215739['gsqSW'])); } }); } function transCmd(_0x2cf4eb, _0x414955, _0x2a08ce, _0x276a51) { var _0xa0eacf = { 'PHhvb': '2|1|7|0|3|4|5|6', 'GoBES': function (_0x278dbf, _0xb84b52) { return _0x278dbf != _0xb84b52; }, 'JQseU': function (_0x4eb224, _0x2a05ab) { return _0x4eb224 == _0x2a05ab; }, 'ibmGW': function (_0x3de94f, _0x4230a6, _0x1bb941, _0x153c13) { return _0x3de94f(_0x4230a6, _0x1bb941, _0x153c13); }, 'qrFHl': 'type\x20错误', 'tmycH': '发送ICC指令超时', 'iRezl': '发送esam指令超时', 'yetli': '5|2|6|4|1|3|0', 'MMFPb': function (_0x277167, _0x3a68d4, _0x108a17, _0x51442e) { return _0x277167(_0x3a68d4, _0x108a17, _0x51442e); }, 'ceKHH': 'successCode', 'fVDGA': function (_0x52ba98, _0x484124) { return _0x52ba98 == _0x484124; }, 'ofgeS': '发送ICC指令成功', 'pHJRc': '发送esam指令成功', 'IIWcC': function (_0x19d20c, _0x5bae2e) { return _0x19d20c != _0x5bae2e; }, 'ctqDr': function (_0x43907d, _0x203a10) { return _0x43907d(_0x203a10); }, 'EdWuH': function (_0x465fb2, _0xa7eede) { return _0x465fb2 > _0xa7eede; }, 'NybkK': function (_0x406641, _0xf9158, _0x3605d3) { return _0x406641(_0xf9158, _0x3605d3); }, 'TvSXk': function (_0x41ba3c, _0x6e3428, _0x54acb3) { return _0x41ba3c(_0x6e3428, _0x54acb3); }, 'yqdFA': function (_0x5115b3, _0x1867c1) { return _0x5115b3 === _0x1867c1; }, 'DdnUq': function (_0x8aff2d, _0x49c847) { return _0x8aff2d == _0x49c847; }, 'hMQbF': function (_0x32e8d0, _0x28dca8) { return _0x32e8d0 != _0x28dca8; }, 'rYLQu': function (_0x1a9e43, _0x31520b) { return _0x1a9e43 != _0x31520b; }, 'dJyBY': function (_0xd7b3d6, _0x3aa456) { return _0xd7b3d6 + _0x3aa456; }, 'fVAXC': function (_0x10fe34, _0xa7c5c7) { return _0x10fe34 < _0xa7c5c7; }, 'wCpqn': function (_0x3e0002, _0x86e0d6) { return _0x3e0002 == _0x86e0d6; } }; var _0x36bb4f = _0xa0eacf['PHhvb']['split']('|'), _0x3a9283 = 0x0; while (!![]) { switch (_0x36bb4f[_0x3a9283++]) { case '0': cmds = _0x414955['slice'](); continue; case '1': if (_0xa0eacf['GoBES'](_0x2cf4eb, 0x0) && _0xa0eacf['GoBES'](_0x2cf4eb, 0x1)) { _0xa0eacf['JQseU'](typeof _0x2a08ce['fail'], FUNCTION) && _0x2a08ce['fail'](_0xa0eacf['ibmGW'](toObject, 0xfa0, undefined, _0xa0eacf['qrFHl'])); return; } continue; case '2': var _0x9db436 = { 'vnmZv': function (_0x3ced1a, _0x50499e) { return _0xa0eacf['JQseU'](_0x3ced1a, _0x50499e); }, 'fkTFj': function (_0x3f6e9d, _0x195953, _0x3f79a1, _0x127305) { return _0xa0eacf['ibmGW'](_0x3f6e9d, _0x195953, _0x3f79a1, _0x127305); }, 'DYHVw': _0xa0eacf['tmycH'], 'uoyvE': _0xa0eacf['iRezl'], 'jFdqD': _0xa0eacf['yetli'], 'Dpxmr': function (_0x1bafba, _0x43de65) { return _0xa0eacf['JQseU'](_0x1bafba, _0x43de65); }, 'cqAPg': function (_0x5a8d2f, _0x269fc8, _0x42f519, _0x2be1f4) { return _0xa0eacf['MMFPb'](_0x5a8d2f, _0x269fc8, _0x42f519, _0x2be1f4); }, 'DopRp': _0xa0eacf['ceKHH'], 'dajhA': function (_0x5a1d17, _0x393e82) { return _0xa0eacf['fVDGA'](_0x5a1d17, _0x393e82); }, 'aaEjk': _0xa0eacf['ofgeS'], 'FGACr': _0xa0eacf['pHJRc'], 'iRMSS': function (_0x48c84b, _0x50c295) { return _0xa0eacf['IIWcC'](_0x48c84b, _0x50c295); }, 'oMtBh': function (_0x4c1cdc, _0x1a1326) { return _0xa0eacf['ctqDr'](_0x4c1cdc, _0x1a1326); }, 'GSOua': function (_0x54e2a6, _0x941318) { return _0xa0eacf['EdWuH'](_0x54e2a6, _0x941318); }, 'vIeru': function (_0x172550, _0x1623ea, _0x1d3f70) { return _0xa0eacf['NybkK'](_0x172550, _0x1623ea, _0x1d3f70); }, 'KRDrT': function (_0x5889bd, _0x191833, _0x49394d) { return _0xa0eacf['TvSXk'](_0x5889bd, _0x191833, _0x49394d); }, 'qnTuw': function (_0x115fed, _0x3f4081) { return _0xa0eacf['yqdFA'](_0x115fed, _0x3f4081); }, 'gpOGU': function (_0x41f230, _0x2da62c) { return _0xa0eacf['fVDGA'](_0x41f230, _0x2da62c); }, 'lneWy': function (_0x58537c, _0x3f4ebe) { return _0xa0eacf['DdnUq'](_0x58537c, _0x3f4ebe); }, 'GITLp': function (_0x517a54, _0x21d9a3) { return _0xa0eacf['hMQbF'](_0x517a54, _0x21d9a3); }, 'DOiix': function (_0x534d4a, _0x4d3035) { return _0xa0eacf['rYLQu'](_0x534d4a, _0x4d3035); }, 'xTEZt': function (_0x4928c8, _0x3040d5) { return _0xa0eacf['ctqDr'](_0x4928c8, _0x3040d5); }, 'SpBBz': function (_0x32ce43, _0x581a2d, _0x3b3335, _0x38f7da) { return _0xa0eacf['MMFPb'](_0x32ce43, _0x581a2d, _0x3b3335, _0x38f7da); }, 'EqZnQ': function (_0x46d526, _0x35873e) { return _0xa0eacf['dJyBY'](_0x46d526, _0x35873e); } }; continue; case '3': var _0x16db8b = new Array(); continue; case '4': var _0x306c79; continue; case '5': var _0x181060; continue; case '6': for (var _0x136bb2 = 0x0; _0xa0eacf['fVAXC'](_0x136bb2, _0x414955['length']); _0x136bb2++) { if (_0xa0eacf['wCpqn'](_0x136bb2, 0x0)) { _0x306c79 = cmds['shift'](); _0x181060 = _0xa0eacf['TvSXk'](promise, _0x306c79, _0x2cf4eb); } _0x181060 = _0x181060['then'](_0x45bb06 => { var _0x44975d = _0x9db436['jFdqD']['split']('|'), _0x23a385 = 0x0; while (!![]) { switch (_0x44975d[_0x23a385++]) { case '0': _0x9db436['Dpxmr'](typeof _0x2a08ce['success'], FUNCTION) && _0x2a08ce['success'](_0x9db436['cqAPg'](toObject, codeEnum[_0x9db436['DopRp']], _0x16db8b, _0x9db436['dajhA'](_0x2cf4eb, 0x0) ? _0x9db436['aaEjk'] : _0x9db436['FGACr'])); continue; case '1': _0x16db8b['push'](_0x45bb06); continue; case '2': if (_0x9db436['iRMSS'](_0x4be629, undefined)) { _0x9db436['oMtBh'](clearTimeout, _0x4be629); } continue; case '3': if (_0x9db436['GSOua'](cmds['length'], 0x0)) { _0x4be629 = _0x9db436['vIeru'](setTimeout, () => { _0x518a64['TnvPR'](typeof _0x2a08ce['fail'], FUNCTION) && _0x2a08ce['fail'](_0x518a64['FtTIF'](toObject, 0x7d0, undefined, _0x518a64['QNhXE'](_0x2cf4eb, 0x0) ? _0x518a64['uZFYF'] : _0x518a64['jUPsI'])); }, _0x276a51); _0x306c79 = cmds['shift'](); return _0x9db436['KRDrT'](promise, _0x306c79, _0x2cf4eb); } continue; case '4': if (_0x9db436['qnTuw'](_0x45bb06, undefined)) { return; } continue; case '5': var _0x518a64 = { 'TnvPR': function (_0x139d30, _0x533592) { return _0x9db436['gpOGU'](_0x139d30, _0x533592); }, 'FtTIF': function (_0x1f347e, _0x16628b, _0x29801e, _0x405680) { return _0x9db436['cqAPg'](_0x1f347e, _0x16628b, _0x29801e, _0x405680); }, 'QNhXE': function (_0x46d987, _0x41b190) { return _0x9db436['lneWy'](_0x46d987, _0x41b190); }, 'uZFYF': _0x9db436['DYHVw'], 'jUPsI': _0x9db436['uoyvE'] }; continue; case '6': if (_0x9db436['qnTuw'](dataHandlerCallback, undefined)) { return; } continue; }break; } }, (_0x1ebbae, _0x17fdac) => { if (_0x9db436['GITLp'](_0x1ebbae, undefined)) { if (_0x9db436['DOiix'](_0x4be629, undefined)) { _0x9db436['xTEZt'](clearTimeout, _0x4be629); } _0x9db436['lneWy'](typeof _0x2a08ce['fail'], FUNCTION) && _0x2a08ce['fail'](_0x9db436['SpBBz'](toObject, 0xfa0, _0x16db8b, _0x9db436['EqZnQ'](_0x306c79, _0x1ebbae))); } }); } continue; case '7': var _0x4be629 = _0xa0eacf['TvSXk'](setTimeout, () => { dataHandlerCallback = undefined; _0x9db436['vnmZv'](typeof _0x2a08ce['fail'], FUNCTION) && _0x2a08ce['fail'](_0x9db436['fkTFj'](toObject, 0x7d0, undefined, _0x9db436['vnmZv'](_0x2cf4eb, 0x0) ? _0x9db436['DYHVw'] : _0x9db436['uoyvE'])); }, _0x276a51); continue; }break; } } function runningSendData() { var _0x171a9b = { 'rSVEl': function (_0x28fbb9, _0x529a85) { return _0x28fbb9 < _0x529a85; }, 'jjHnV': 'length', 'oNOFT': function (_0x550ace) { return _0x550ace(); }, 'cenTe': 'log', 'prEPx': function (_0x29cc7a, _0x3e944f) { return _0x29cc7a + _0x3e944f; }, 'sgCDp': function (_0x2f3d13, _0x100558) { return _0x2f3d13 - _0x100558; }, 'mDCVE': '次重发', 'DZSmd': function (_0x441106, _0x30db40) { return _0x441106 == _0x30db40; }, 'Nynbn': function (_0xae95d6, _0x488f27) { return _0xae95d6 > _0x488f27; }, 'pqdco': function (_0x51b370, _0x438807, _0x1d8dc2) { return _0x51b370(_0x438807, _0x1d8dc2); }, 'SlXyP': function (_0x3522d6, _0x11f7bd) { return _0x3522d6(_0x11f7bd); }, 'QVsSC': function (_0x54365a, _0x3e9623, _0x228622, _0x3f420b) { return _0x54365a(_0x3e9623, _0x228622, _0x3f420b); }, 'azFmz': 'sendDataFailure', 'aDIJU': '发送数据失败', 'fHmBj': 'bufferArrayToHexString', 'usSci': function (_0x301aed, _0x27405e) { return _0x301aed + _0x27405e; }, 'ePeXn': '发送：', 'hwFaL': 'writeBLECharacteristicValue' }; let _0x3d4193 = sendBufferArray[sendIndex]; let _0x1e2b61 = dataHandler[_0x171a9b['fHmBj']](_0x3d4193); console[_0x171a9b['cenTe']](_0x171a9b['usSci'](_0x171a9b['ePeXn'], _0x1e2b61)); wx[_0x171a9b['hwFaL']]({ 'deviceId': connectDeviceId, 'serviceId': serviceUUID, 'characteristicId': writeUUID, 'value': _0x3d4193, 'success': function (_0x2fb6b1) { sendIndex++; if (_0x171a9b['rSVEl'](sendIndex, sendBufferArray[_0x171a9b['jjHnV']])) { _0x171a9b['oNOFT'](runningSendData); } }, 'fail': function () { var _0x314346 = { 'qsbSZ': _0x171a9b['cenTe'], 'afugy': function (_0x4c0be5, _0x85606f) { return _0x171a9b['prEPx'](_0x4c0be5, _0x85606f); }, 'DMlKx': function (_0x2f08da, _0x5d1bee) { return _0x171a9b['prEPx'](_0x2f08da, _0x5d1bee); }, 'EWlwa': function (_0x2d4fc1, _0x48185f) { return _0x171a9b['sgCDp'](_0x2d4fc1, _0x48185f); }, 'CNLvM': _0x171a9b['mDCVE'], 'NujAS': function (_0x57b2d1) { return _0x171a9b['oNOFT'](_0x57b2d1); } }; if (_0x171a9b['DZSmd'](dataHandlerCallback, undefined)) { return; } if (_0x171a9b['Nynbn'](resendCount, 0x0)) { resendCount--; _0x171a9b['pqdco'](setTimeout, () => { console[_0x314346['qsbSZ']](_0x314346['afugy'](_0x314346['DMlKx']('第', _0x314346['EWlwa'](0x3, resendCount)), _0x314346['CNLvM'])); _0x314346['NujAS'](runningSendData); }, 0xc8); } else { _0x171a9b['DZSmd'](typeof dataHandlerCallback, FUNCTION) && _0x171a9b['SlXyP'](dataHandlerCallback, _0x171a9b['QVsSC'](toObject, codeEnum[_0x171a9b['azFmz']], '', _0x171a9b['aDIJU'])); } } }); }