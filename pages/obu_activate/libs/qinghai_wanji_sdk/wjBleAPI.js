"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_wjUtils=require("./wjUtils.js"),_wjUtils2=_interopRequireDefault(_wjUtils),_wjService=require("./wjService.js"),_wjService2=_interopRequireDefault(_wjService),_wjDataInteract=require("./wjDataInteract.js"),_wjDataInteract2=_interopRequireDefault(_wjDataInteract),_wjDataAnalysis=require("./wjDataAnalysis.js"),_wjDataAnalysis2=_interopRequireDefault(_wjDataAnalysis),_wjDataEncode=require("./wjDataEncode.js"),_wjDataEncode2=_interopRequireDefault(_wjDataEncode);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var TAG_FUNCTION="function";function connectDevice(t){_wjService2.default.reallyScanConnect(function(e){(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(e)})}function connectDevice2(e,t){var a={};_wjService2.default.reallyConnect(e,function(e){a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function disConnectDevice(t){var a={};_wjService2.default.reallyDisConnect(function(e){a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getDeviceInfo(e,t){var a,i={},n="",s=_wjUtils2.default.getCMD_TYPE();0==s?n="810100"+e:1==s&&(n="A501"+e),a=_wjDataEncode2.default.encode(n),_wjDataInteract2.default._StartSendData(a.serviceData.dataEncode,function(e){i=0==e.serviceCode?(_wjUtils2.default.showLog("获取设备信息成功"),_wjDataAnalysis2.default.analysisDeviceInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(i)})}function initIC(t){var e,a={},i="",n=_wjUtils2.default.getCMD_TYPE();0==n?i="80":1==n&&(i="A2"),e=_wjDataEncode2.default.encode(i),_wjDataInteract2.default._StartSendData(e.serviceData.dataEncode,function(e){0==(a=e).serviceCode?a.serviceInfo="初始化成功":a.serviceInfo="初始化失败",(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function selectDir(a,e,i){var n={};if(4==a.length&&"10"==e||"20"==e){var t="010700A4000002"+a,s=e,d="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(t=_wjUtils2.default.TPDU2APDU(t));var o=_wjUtils2.default.getCMD_TYPE();0==o?d="82":1==o&&(d="A3"),this.transCommandPlain(t,s,d,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);n=e,0==t.serviceCode&&(_wjUtils2.default.showLog("进 "+a+" 目录成功"),n.serviceInfo="进"+a+"目录成功"),(void 0===i?"undefined":_typeof(i))==TAG_FUNCTION&&i(n)}else n=e,(void 0===i?"undefined":_typeof(i))==TAG_FUNCTION&&i(n)})}else n.serviceCode=-1,n.serviceInfo="参数长度有误",(void 0===i?"undefined":_typeof(i))==TAG_FUNCTION&&i(n)}function getCardInfo(t){var a={},e="010500B095002B0205805C000204",i="",n="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(i="10",n="82"):1==s&&(i="00",n="A3"),this.transCommandPlain(e,i,n,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取卡片信息成功"),_wjDataAnalysis2.default.analysisCardInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function transCommandPlain(e,t,a,i){var n={};if("10"==t||"20"==t||"30"==t||"00"==t){var s;s=_wjDataEncode2.default.encode(e,t,a),_wjDataInteract2.default._StartSendData(s.serviceData.dataEncode,function(e){n=(0==e.serviceCode&&_wjUtils2.default.showLog("APDU透传指令成功"),e),(void 0===i?"undefined":_typeof(i))==TAG_FUNCTION&&i(n)})}else n.serviceCode=-1,n.serviceInfo="command参数错误！",(void 0===i?"undefined":_typeof(i))==TAG_FUNCTION&&i(n)}function getRand(e,t){var a={},i="01050084000004",n=e,s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?s="82":1==d&&(s="A3"),this.transCommandPlain(i,n,s,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取IC随机数成功"),_wjDataAnalysis2.default.analysisGetRand(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getObuSysInfo(t){var a={},e="010500B081001B",i="",n="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(i="20",n="82"):1==s&&(i="00",n="A0"),this.transCommandPlain(e,i,n,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取系统信息成功"),_wjDataAnalysis2.default.analysisgetObuSysInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function readCardOwnerRecord(t){var a={},e="010500B0960037",i="",n="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(i="10",n="82"):1==s&&(i="00",n="A3"),this.transCommandPlain(e,i,n,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("获取持卡人信息成功"),(a=_wjDataAnalysis2.default.analysisCardOwnerRecord(e.serviceData.dataBuff)).serviceCode=0,a.serviceInfo="获取持卡人信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function readCardTransactionRecord(e,t){var a={},i="010500B2"+_wjUtils2.default.byte2hexStr(e)+"C400",n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="10",s="82"):1==d&&(n="00",s="A3"),this.transCommandPlain(i,n,s,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("获取交易记录信息成功"),(a=_wjDataAnalysis2.default.analysisCardTransactionRecord(e.serviceData.dataBuff)).serviceCode=0,a.serviceInfo="获取交易记录信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function readCardConsumeRecord(e,t){var a={},i="010500B2"+_wjUtils2.default.byte2hexStr(e)+"CC00",n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="10",s="82"):1==d&&(n="00",s="A3"),this.transCommandPlain(i,n,s,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("获取过站信息成功"),(a=_wjDataAnalysis2.default.analysisgetCardConsumeRecord(e.serviceData.dataBuff)).serviceCode=0,a.serviceInfo="获取过站信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function authPIN(e,a){var i={};if(e.length%2==0&&6<=e.length&&e.length<=12){var t=_wjUtils2.default.byte2hexStr(parseInt(e.length/2)),n="01"+_wjUtils2.default.byte2hexStr(5+parseInt(e.length/2))+"00200000"+t+e,s="",d="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(n=_wjUtils2.default.TPDU2APDU(n));var o=_wjUtils2.default.getCMD_TYPE();0==o?(s="10",d="82"):1==o&&(s="00",d="A3"),this.transCommandPlain(n,s,d,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);i=e,0==t.serviceCode&&(_wjUtils2.default.showLog("PIN认证成功"),i.serviceInfo="PIN认证成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)}else i=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)})}else i.serviceCode=-1,i.serviceInfo="参数长度有误",(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)}function initLoadCreadit(e,t,a,i,n,s){var d={};if(null!=e&&null!=t&&null!=a&&null!=i&&null!=n)if(12==a.length&&2==i.length&&2==n.length){var o=new ArrayBuffer(4),f=new DataView(o);f.setInt8(0,t>>24&255),f.setInt8(1,t>>16&255),f.setInt8(2,t>>8&255),f.setInt8(3,t>>0&255);var l="0110805000"+i+"0B"+n+_wjUtils2.default.byteArray2hexStr(o)+a,r="",u="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(l=_wjUtils2.default.TPDU2APDU(l));var _=_wjUtils2.default.getCMD_TYPE();0==_?(r="10",u="82"):1==_&&(r="00",u="A3"),this.transCommandPlain(l,r,u,function(e){d=0==e.serviceCode?(_wjUtils2.default.showLog("圈存初始化成功123"),_wjDataAnalysis2.default.analysisInitInfo(e.serviceData.dataBuff)):e,(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d)})}else d.serviceCode=-2,d.serviceInfo="参数长度有误！",(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d);else d.serviceCode=-1,d.serviceInfo="参数有空！",(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d)}function loadCreadit(e,t){var a={};if(null!=e&&22==e.length){var i="0111805200000B"+e+"04",n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="10",s="82"):1==d&&(n="00",s="A3"),this.transCommandPlain(i,n,s,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("圈存成功"),_wjDataAnalysis2.default.analysisLoadCreadit(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}else a.serviceCode=-1,a.serviceInfo="获取圈存指令失败：参数null或长度有误",(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)}function writeObuIssue(e,a){var i={};if(null!=e&&20==e.length){var t="010A"+e,n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(t=_wjUtils2.default.TPDU2APDU(t));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="20",s="82"):1==d&&(n="00",s="A0"),this.transCommandPlain(t,n,s,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);i=e,0==t.serviceCode&&(_wjUtils2.default.showLog("OBU激活成功"),i.serviceInfo="OBU激活成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)}else i=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)})}else i.serviceCode=-1,i.serviceInfo="激活参数错误",(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)}function getVehCipherInfo(t){var a={},e="010F00B400000A01020304050607083B00",i="",n="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(i="20",n="82"):1==s&&(i="00",n="A0"),this.transCommandPlain(e,i,n,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取车辆信息密文成功"),_wjDataAnalysis2.default.analysisVehCipherInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeObuIssueSpecial(a){var i={},e="01050059000001";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e)),this.transCommandPlain(e,"20","82",function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);i=e,0==t.serviceCode&&(_wjUtils2.default.showLog("特殊激活OBU设备成功"),i.serviceInfo="特殊激活OBU设备成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)}else i=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(i)})}function writeObuSysInfo(e,t){var a={},i="01"+_wjUtils2.default.byte2hexStr(parseInt(e.length/2))+e,n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="20",s="82"):1==d&&(n="00",s="A0"),this.transCommandPlain(i,n,s,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("写系统信息成功"),(a=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff)).serviceInfo="写系统信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeVehInfo(e,t){var a={},i="01"+_wjUtils2.default.byte2hexStr(parseInt(e.length/2))+e;1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var n=_wjUtils2.default.getCMD_TYPE();0==n?(command="20",channel="82"):1==n&&(command="00",channel="A0"),this.transCommandPlain(i,command,channel,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("写车辆信息成功"),(a=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff)).serviceInfo="写车辆信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeIC15Info(e,t){var a={},i="01"+_wjUtils2.default.byte2hexStr(parseInt(e.length/2))+e;1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var n=_wjUtils2.default.getCMD_TYPE();0==n?(command="10",channel="82"):1==n&&(command="00",channel="A3"),this.transCommandPlain(i,command,channel,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("写IC卡15文件成功"),(a=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff)).serviceInfo="写IC卡15文件成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeIC16Info(e,t){var a={},i="01"+_wjUtils2.default.byte2hexStr(parseInt(e.length/2))+e,n="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var d=_wjUtils2.default.getCMD_TYPE();0==d?(n="10",s="82"):1==d&&(n="00",s="A3"),this.transCommandPlain(i,n,s,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("写IC卡16文件成功"),(a=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff)).serviceInfo="写IC卡16文件成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}module.exports={connectDevice:connectDevice,disConnectDevice:disConnectDevice,getDeviceInfo:getDeviceInfo,getCardInfo:getCardInfo,authPIN:authPIN,initLoadCreadit:initLoadCreadit,loadCreadit:loadCreadit,getObuSysInfo:getObuSysInfo,writeObuIssue:writeObuIssue,getVehCipherInfo:getVehCipherInfo,transCommandPlain:transCommandPlain,writeObuIssueSpecial:writeObuIssueSpecial,readCardTransactionRecord:readCardTransactionRecord,readCardOwnerRecord:readCardOwnerRecord,readCardConsumeRecord:readCardConsumeRecord,writeObuSysInfo:writeObuSysInfo,writeVehInfo:writeVehInfo,writeIC16Info:writeIC16Info,writeIC15Info:writeIC15Info,selectDir:selectDir,getRand:getRand,initIC:initIC};