"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_wjUtils=require("./wjUtils.js"),_wjUtils2=_interopRequireDefault(_wjUtils),_wjService=require("./wjService.js"),_wjService2=_interopRequireDefault(_wjService),_wjDataInteract=require("./wjDataInteract.js"),_wjDataInteract2=_interopRequireDefault(_wjDataInteract),_wjDataAnalysis=require("./wjDataAnalysis.js"),_wjDataAnalysis2=_interopRequireDefault(_wjDataAnalysis),_wjDataEncode=require("./wjDataEncode.js"),_wjDataEncode2=_interopRequireDefault(_wjDataEncode);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var TAG_FUNCTION="function";function connectDevice(t){_wjService2.default.reallyScanConnect(function(e){(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(e)})}function connectDevice2(e,t){_wjService2.default.reallyConnect(e,function(e){(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(e)})}function disConnectDevice(t){_wjService2.default.reallyDisConnect(function(e){(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(e)})}function transCommand(e,t,a,n){var i={};if("10"==t||"20"==t||"30"==t||"00"==t||"11"==t||"21"==t||"31"==t||"01"==t){var s;s=_wjDataEncode2.default.encode(e,t,a),_wjDataInteract2.default._StartSendData(s.serviceData.dataEncode,function(e){0==e.serviceCode?((i=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff)).serviceData={},0==i.serviceCode&&(i.serviceInfo="trans success"),i.serviceData.dataBuff=e.serviceData.dataBuff,console.log(i)):i=e,(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)})}else i.serviceCode=-1,i.serviceInfo="command参数错误！",(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}function initIC(t){var e,a={},n="",i=_wjUtils2.default.getCMD_TYPE();0==i?n="80":1==i&&(n="A2"),e=_wjDataEncode2.default.encode(n),_wjDataInteract2.default._StartSendData(e.serviceData.dataEncode,function(e){0==(a=e).serviceCode?(_wjUtils2.default.showLog("IC卡复位成功"),a.serviceInfo="IC卡复位成功"):a.serviceInfo="IC卡复位失败",(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getDeviceInfo(e,t){var a,n={},i="",s=_wjUtils2.default.getCMD_TYPE();0==s?i="810100"+e:1==s&&(i="A501"+e),a=_wjDataEncode2.default.encode(i),_wjDataInteract2.default._StartSendData(a.serviceData.dataEncode,function(e){n=0==e.serviceCode?(_wjUtils2.default.showLog("获取设备信息成功"),_wjDataAnalysis2.default.analysisDeviceInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(n)})}function selectDir(a,e,t,n){var i={};if(4==a.length&&"10"==e||"20"==e){var s="010700A4000002"+a;1==_wjUtils2.default.getTRANSFER_TYPE()&&(s=_wjUtils2.default.TPDU2APDU(s)),transCommand(s,e,t,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);i=e,0==t.serviceCode&&(_wjUtils2.default.showLog("进 "+a+" 目录成功"),i.serviceInfo="进"+a+"目录成功"),(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}else i=e,(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)})}else i.serviceCode=-1,i.serviceInfo="参数长度有误",(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}function getCardInfo(t){var a={},e="010500B095002B0205805C000204",n="",i="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(n="10",i="82"):1==s&&(n="00",i="A3"),this.transCommand(e,n,i,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取卡片信息成功"),_wjDataAnalysis2.default.analysisCardInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function readCardOwnerRecord(t){var a={},e="010500B0960037",n="",i="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(n="10",i="82"):1==s&&(n="00",i="A3"),this.transCommand(e,n,i,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("获取持卡人信息成功"),(a=_wjDataAnalysis2.default.analysisCardOwnerRecord(e.serviceData.dataBuff)).serviceCode=0,a.serviceInfo="获取持卡人信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function readCardTransactionRecord(e,t){var a={},n="010500B2"+_wjUtils2.default.byte2hexStr(e)+"C400",i="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(n=_wjUtils2.default.TPDU2APDU(n));var d=_wjUtils2.default.getCMD_TYPE();0==d?(i="10",s="82"):1==d&&(i="00",s="A3"),this.transCommand(n,i,s,function(e){0==e.serviceCode?(_wjUtils2.default.showLog("获取交易记录信息成功"),(a=_wjDataAnalysis2.default.analysisCardTransactionRecord(e.serviceData.dataBuff)).serviceCode=0,a.serviceInfo="获取交易记录信息成功"):a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function authPIN(e,a){var n={};if(e.length%2==0&&6<=e.length&&e.length<=12){var t=_wjUtils2.default.byte2hexStr(parseInt(e.length/2)),i="01"+_wjUtils2.default.byte2hexStr(5+parseInt(e.length/2))+"00200000"+t+e,s="",d="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i));var o=_wjUtils2.default.getCMD_TYPE();0==o?(s="10",d="82"):1==o&&(s="00",d="A3"),this.transCommand(i,s,d,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);n=e,0==t.serviceCode&&(_wjUtils2.default.showLog("PIN认证成功"),n.serviceInfo="PIN认证成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}else n=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)})}else n.serviceCode=-1,n.serviceInfo="参数长度有误",(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}function initLoadCreadit(e,t,a,n,i,s){var d={};if(null!=e&&null!=t&&null!=a&&null!=n&&null!=i)if(12==a.length&&2==n.length&&2==i.length){var o=new ArrayBuffer(4),f=new DataView(o);f.setInt8(0,t>>24&255),f.setInt8(1,t>>16&255),f.setInt8(2,t>>8&255),f.setInt8(3,t>>0&255);var l="0110805000"+n+"0B"+i+_wjUtils2.default.byteArray2hexStr(o)+a,r="",u="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(l=_wjUtils2.default.TPDU2APDU(l));var _=_wjUtils2.default.getCMD_TYPE();0==_?(r="10",u="82"):1==_&&(r="00",u="A3"),this.transCommand(l,r,u,function(e){d=0==e.serviceCode?(_wjUtils2.default.showLog("圈存初始化成功123"),_wjDataAnalysis2.default.analysisInitInfo(e.serviceData.dataBuff)):e,(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d)})}else d.serviceCode=-2,d.serviceInfo="参数长度有误！",(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d);else d.serviceCode=-1,d.serviceInfo="参数有空！",(void 0===s?"undefined":_typeof(s))==TAG_FUNCTION&&s(d)}function loadCreadit(e,t){var a={};if(null!=e&&22==e.length){var n="0111805200000B"+e+"04",i="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(n=_wjUtils2.default.TPDU2APDU(n));var d=_wjUtils2.default.getCMD_TYPE();0==d?(i="10",s="82"):1==d&&(i="00",s="A3"),this.transCommand(n,i,s,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("圈存成功"),_wjDataAnalysis2.default.analysisLoadCreadit(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}else a.serviceCode=-1,a.serviceInfo="获取圈存指令失败：参数null或长度有误",(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)}function getRand(e,t,a){var n={},i="01050084000004";1==_wjUtils2.default.getTRANSFER_TYPE()&&(i=_wjUtils2.default.TPDU2APDU(i)),this.transCommand(i,e,t,function(e){n=0==e.serviceCode?(_wjUtils2.default.showLog("获取IC随机数成功"),_wjDataAnalysis2.default.analysisGetRand(e.serviceData.dataBuff)):e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)})}function getObuSysInfo(t){var a={},e="010500B081001B",n="",i="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var s=_wjUtils2.default.getCMD_TYPE();0==s?(n="20",i="82"):1==s&&(n="00",i="A0"),transCommand(e,n,i,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取系统信息成功"),_wjDataAnalysis2.default.analysisgetObuSysInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeObuIssue(e,a){var n={};if(null!=e&&20==e.length){var t="01"+_wjUtils2.default.byte2hexStr(parseInt(e.length/2))+e,i="",s="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(t=_wjUtils2.default.TPDU2APDU(t));var d=_wjUtils2.default.getCMD_TYPE();0==d?(i="20",s="82"):1==d&&(i="00",s="A0"),this.transCommand(t,i,s,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);n=e,0==t.serviceCode&&(_wjUtils2.default.showLog("OBU激活成功"),n.serviceInfo="OBU激活成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}else n=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)})}else n.serviceCode=-1,n.serviceInfo="激活参数错误",(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}module.exports={connectDevice:connectDevice,connectDevice2:connectDevice2,disConnectDevice:disConnectDevice,transCommand:transCommand,getDeviceInfo:getDeviceInfo,initIC:initIC};