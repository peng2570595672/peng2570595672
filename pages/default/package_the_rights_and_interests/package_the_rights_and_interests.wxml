<wxs src='../../../utils/util.wxs' module='tools' />
<view class="index">
    <!-- 顶部 进度条 组件 -->
    <view class="topSplit">
        <topProgressBar progressStage="{{topProgressBar}}" />
    </view>
    <!-- 套餐模块 -->
    <view class="package" wx:for="{{listOfPackages}}" wx:key="index">
        <view class="module moduleOne iconfont {{'module' + index}} {{index === activeIndex ? 'btnHighLight' : ''}}" data-index="{{index}}" catchtap="btnHeightLight">
            <!-- 活动标签 限制字符8个 -->
            <view class="active {{index === activeIndex ? 'activeChange' : ''}}" wx:if="{{true}}">
                <text>{{tools.limitNumber('限时活动限时活动111',8)}}</text>
            </view>
            <!-- 默认展示的套餐上半部分 -->
            <view class="upperPart {{tools.dataLen(item.rightsPackageIds) > 0 || item.isSignTtCoupon ? '' : 'subUpperPart'}}">
                <!-- 背景logo -->
                <view class="bgImg">
                    <image src="{{item.productLogo}}" />
                </view>
                <view class="titleMOney">
                    <!-- 套餐名称：取后台套餐名称 -->
                    <view class="title">{{tools.limitNumber(item.productName,18)}}</view>
                    <!-- 取后台支付金额，保留小数点后2位，若套餐支付金额为0时，前端价格展示为免费 -->
                    <view class="money">
                        <span wx:if="{{item.pledgePrice !== 0}}">
                            ￥{{tools.parseNum(item.pledgePrice/100)}}
                        </span>
                        <span wx:else style="color: #0f0">免费</span>
                    </view>
                    <view class="titleExplain" wx:if="{{true}}">
                        <view class="innerBox1">
                            <text class="innerBox2">现金限时膨账 \n</text>
                            <text class="innerBox2">权益商城100+权益任兑</text>
                        </view>
                    </view>
                </view>
                <!-- 副标题：取后台套餐副标题（原套餐全称productLogo） -->
                <view class="subTitle">{{tools.limitNumber(item.fullName,15)}}</view>
                <!-- 套餐描述 取后台配置展示，若无配置则不展示 -->
                <view class="description" wx:if="{{tools.dataLen(basicServiceList) > 0}}">
                    <view class="descriptionModule" wx:for="{{basicServiceList}}" wx:key="index1">
                        <view class="ico">
                            <!-- <image class="image" src="{{item.ico}}" /> -->
                        </view>
                        <view class="title">{{item.title}}</view>
                    </view>
                </view>
            </view>
            <!-- 增值业务 展示的套餐下半部分 如果又权益和签约通通券则展示-->
            <view class="lowerpart" wx:if="{{tools.dataLen(item.rightsPackageIds) || item.isSignTtCoupon}}">
                <view class="titleDetails">
                    <view class="titles">
                        <view class="iconfont {{item.isSignTtCoupon ? 'isSignTtCoupon' : 'icon'}}"></view>
                        <view class="text">{{item.isSignTtCoupon ? 'ETC*通通券联名会员权益' : equityListMap[index].packageName}}</view>
                    </view>
                    <view class="details" catchtap="btnOpenOrOff" data-index="{{[index,isCloseUpperPart,activeIndex]}}">
                        {{ index === activeIndex ? isCloseUpperPart1 ? '收起' : '展开' : isCloseUpperPart2 && index === isCloseUpperPart ? '收起' : '展开'}}
                    </view>
                </view>
                <!-- 套餐 展示模块 -->
                <view class="detailsInfo" wx:if="{{index === activeIndex ? isCloseUpperPart1 : isCloseUpperPart2 && index === isCloseUpperPart }}">
                    <!-- 券权益包 -->
                    <addValueService addValueService="{{item.rightsPackageIds}}" wx:if="{{tools.dataLen(item.rightsPackageIds)}}"></addValueService>
                    <!-- 通通券 -->
                    <view wx:elif="{{item.isSignTtCoupon}}" class="isSignTtCoupon">
                        <view wx:if="{{item.ttCouponPayAmount > 0}}" class="ttImgs">
                            <image class="ttImg" src="/pages/default/assets/equities1.png" />
                        </view>
                        <view wx:if="{{item.ttCouponPayAmount === 0}}" class="ttImgs">
                            <image class="ttImg" src="/pages/default/assets/equities2.png" />
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>
    <!-- 占位 -->
    <view class="split {{ isFade ? (activeIndex > tools.dataLen(listOfPackages)-3? 'bigSplit' : '') : 'littleSplit'}}" >
        <text >亲，没有更多的套餐了</text>
    </view>
    <!-- 支付和协议说明 模块 -->
    <view class="payAndAgreement {{isFade ? 'fadeIn' : 'fadeOut'}}">
        <view class="agreementConfirm" bindtap="consentAgreement">
            <view class="confirm iconfont {{isConfirm ? 'tick' : ''}}" catchtap="consentAgreement"></view>
            <view class="agreement">
                当您勾选同意并点击“立即支付”按钮，即代表您已阅读、理解并接受
                <span class="agreementColor">ETC+用户协议及黔通卡用户协议及隐私协议</span>
                里的相关规定 ; 若您不认可、不接受上述内容。请勿支付并退出该页面即可。
            </view>
        </view>

        <view class="moneyPay {{isFade ? 'confirmPackage' : ''}}">
            <view class="money" wx:if="{{isFade}}">
                ￥<span class="mpneySpan">
                    {{tools.parseNum(listOfPackages[activeIndex].pledgePrice/100)}}
                </span>
            </view>
            <view class="pay {{ !isFade ? 'payWidth' : ''}} {{isConfirm ? 'payColor' : ''}}" data-isconfirm="{{isConfirm}}" catchtap="payMoney">
                {{listOfPackages[activeIndex].isSignTtCoupon === 0 && listOfPackages[activeIndex].ttCouponPayAmount > 0 ? '通通券代扣金额' : '去支付'}}
            </view>
        </view>
    </view>
</view>